# 🎵 Music Plugin - 网易云点歌插件（Napcat小程序卡片版）
091版本
## 插件简介
本插件为群聊/私聊环境下的“网易云音乐点歌”场景设计，**核心亮点是通过 Napcat 发送“音乐小程序卡片”**，体验原生美观，支持自动识别点歌意图、详细信息展示、灵活配置等。

## 主要功能

- **小程序卡片点歌**：自动识别用户点歌意图，优先以 Napcat 小程序卡片形式推送网易云音乐，支持群聊和私聊。
- **详细信息展示**：卡片发送失败时，自动补发歌曲详情、播放链接等信息。
- **灵活配置**：支持音质、API地址、显示选项等自定义。
- **命令与关键词支持**：支持自然语言点歌和 /music 命令点歌。
- **B站随机视频彩蛋**：支持“来首歌”关键词触发B站UP主随机视频推荐。
- **详细美化回复**：点歌成功后，自动美化并润色歌曲详细信息，提升交互体验。
- **Napcat卡片发送响应优化**：卡片发送成功后自动生成友好提示，失败时自动降级为文本直链。
- **测试命令**：支持 `/test_napcat_card` 命令测试Napcat卡片推送。

## 使用方式

- **自然语言点歌**：在群聊或私聊中发送如“我想听音乐”“点首歌”“来首music”等消息，插件会自动识别并推送网易云音乐小程序卡片。
- **命令点歌**：发送 `/music 歌曲名`，如 `/music 晴天`，可直接点歌。
- **测试Napcat卡片**：发送 `/test_napcat_card [id] [type]` 测试Napcat卡片推送。
- **B站随机视频**：发送“来首歌”可获得B站UP主的随机视频推荐。

## 配置说明

插件首次运行会自动生成 `config.toml`，可配置：

- **API设置**：音乐API服务器地址（默认 https://api.vkeys.cn）
- **音质选择**：默认音质等级(1-9)
- **显示选项**：是否显示专辑封面、下载链接等
- **功能开关**：各项功能的启用状态

## 依赖与环境

- **依赖**：aiohttp、requests
- **API服务**：vkeys.cn 网易云音乐API
- **Napcat机器人**：
  - Napcat“网络配置”需：
    - 建立 HTTP 服务器，监听 `127.0.0.1:4998`
    - 关闭 WebSocket
    - 关闭 CORS
    - 不启用 TOKEN
  - 只有满足以上设置，插件的音乐卡片功能才能正常使用。

## 主要命令与Action

- `/music 歌曲名`：点歌命令，返回网易云音乐卡片或详细信息
- `/test_napcat_card [id] [type]`：测试Napcat音乐卡片推送
- 关键词“来首歌”：触发B站UP主随机视频推荐
- 关键词“音乐”“歌曲”“点歌”“听歌”等：自动触发点歌

## 典型体验

- 群友点歌后，群内直接收到“网易云音乐小程序卡片”，可一键播放、查看专辑封面、歌手等信息。
- 若卡片发送失败，自动补发歌曲文本信息和直链，保证点歌体验不中断。
- 支持详细歌曲信息美化展示。
- 支持B站UP主视频彩蛋推荐。
- 支持Napcat卡片推送测试命令。

## 版本信息

- 版本: 1.0.0
- 作者: 靓仔
- 重写者: Schxar

---

> ⚠️ **本插件主打“音乐小程序卡片”体验，推荐配合 Napcat 使用，享受原生卡片点歌！**
